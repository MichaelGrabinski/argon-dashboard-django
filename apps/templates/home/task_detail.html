{% extends 'layouts/base.html' %}

{% block title %} Task Detail {% endblock title %}

{% block stylesheets %}
<style>
    .status-open { border-left: 5px solid #007bff; } /* Blue */
    .status-closed { border-left: 5px solid #6c757d; } /* Gray */
    .status-in_progress { border-left: 5px solid #ffc107; } /* Yellow */
    .status-waiting_for_materials { border-left: 5px solid #17a2b8; } /* Teal */
    .status-on_hold { border-left: 5px solid #dc3545; } /* Red */
    .priority-low { border-left: 5px solid #28a745; } /* Green */
    .priority-medium { border-left: 5px solid #ffc107; } /* Yellow */
    .priority-high { border-left: 5px solid #dc3545; } /* Red */
</style>
{% endblock stylesheets %}

{% block content %}
<div class="container">
    <h1>{{ task.title }}</h1>
    <div class="card status-{{ task.status }} priority-{{ task.priority }}">
        <div class="card-body">
            <p>{{ task.description }}</p>
            <p><strong>Status:</strong> {{ task.get_status_display }}</p>
            <p><strong>Priority:</strong> {{ task.get_priority_display }}</p>
            <p><strong>Category:</strong> {{ task.category }}</p>
            <p><strong>Hours:</strong> {{ task.hours }}</p>
            <p><strong>Due Date:</strong> {{ task.due_date }}</p>
            <p><strong>Assigned To:</strong> {% if task.assigned_to %}{{ task.assigned_to.username }}{% else %}Not assigned{% endif %}</p>
            <p><strong>Location:</strong> {{ task.location.name }}</p>
            <p><strong>Created By:</strong> {{ task.created_by.username }}</p>
            <p><strong>Created At:</strong> {{ task.created_at }}</p>
            <p><strong>Updated At:</strong> {{ task.updated_at }}</p>
        </div>
    </div>

    <h2>Attachments</h2>
    <ul>
        {% for attachment in attachments %}
            <li><a href="{{ attachment.file.url }}" target="_blank">{{ attachment.file.name }}</a></li>
        {% endfor %}
    </ul>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ attachment_form.as_p }}
        <button type="submit" name="attachment" class="btn btn-primary">Add Attachment</button>
    </form>

    <h2>Comments</h2>
    <ul>
        {% for comment in comments %}
            <li>{{ comment.content }} - <small>{{ comment.user.username }} at {{ comment.created_at }}</small></li>
        {% endfor %}
    </ul>
    <form method="post">
        {% csrf_token %}
        {{ comment_form.as_p }}
        <button type="submit" name="comment" class="btn btn-primary">Add Comment</button>
    </form>

    <h2>Activity Log</h2>
    <ul>
        {% for log in activity_logs %}
            <li>{{ log.action }} - <small>{{ log.user.username }} at {{ log.timestamp }}</small></li>
        {% endfor %}
    </ul>

    <h2>Assign Task</h2>
    <form method="post">
        {% csrf_token %}
        {{ assign_task_form.as_p }}
        <button type="submit" name="assign_task" class="btn btn-primary">Assign Task</button>
    </form>

    <h2>Update Status</h2>
    <form method="post">
        {% csrf_token %}
        <select name="status" class="form-control">
            {% for key, value in task.STATUS_CHOICES %}
                <option value="{{ key }}" {% if task.status == key %}selected{% endif %}>{{ value }}</option>
            {% endfor %}
        </select>
        <button type="submit" name="update_status" class="btn btn-primary">Update Status</button>
    </form>
</div>
{% endblock content %}